Bootstrap: docker
From: bilbydev/bilby_pipe-test-suite-python37

%post
export PATH=/opt/conda/bin:${PATH}
apt-get install -y git
pip install dynesty
pip install nestle
pip install astropy
pip install lalsuite
pip install gwpy
git clone https://github.com/lscsoft/bilby.git
(cd bilby && python setup.py install)
git clone https://github.com/lscsoft/bilby_pipe.git
(cd bilby_pipe && python setup.py install)

%runscript
    simg=$(cat /.singularity.d/labels.json | python -c 'import sys, json; print(json.load(sys.stdin)["org.label-schema.usage.singularity.deffile"])')
    bilby_pipe "$@" --singularity-image $simg

%apprun generation
    bilby_pipe_generation "$@"

%apprun analysis
    bilby_pipe_analysis "$@"

%apprun create_injection_file
    bilby_pipe_create_injection_file "$@"
